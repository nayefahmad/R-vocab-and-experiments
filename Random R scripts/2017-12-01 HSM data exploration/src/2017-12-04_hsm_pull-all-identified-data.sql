

--------------------------
-- PULL ALL HSM DATA
--------------------------

SELECT  [RefreshYear]
      ,[RetentionDate]
      ,[FiscalYear]
      ,[HSMStudyID]
      ,[PatientStudyID]
      ,[IsPatientIDUnique]
      ,[LHA] -- this is the lowest geo level 
      ,[HSDA] --
      ,[HA] --
      ,[POP_SEGMENT] -- 
      ,[POP_SEGMENT_LAST_YEAR] --
      
	  -- flags for each ps: 
	  ,[PS01]
      ,[PS02]
      ,[PS03]
      ,[PS04]
      ,[PS05]
      ,[PS06]
      ,[PS07]
      ,[PS08]
      ,[PS09]
      ,[PS10]
      ,[PS11]
      ,[PS12]
      ,[PS13]
      ,[PS14]

	  ,[ATTACHED_PRACTICE]
	  ,[ATTACHED_GP] -- prob more important than attached_practice 

	  -- chronic conditions:
	  -- cystic f. is binary, others are date of diagnosis?  
      ,[CYSTIC_FIBROSIS]
      ,[ALZHEIMER_DEMENTIA]
      ,[AMI]
      ,[ANGINA]
      ,[ASTHMA]
      ,[CABG]
      ,[CARDIOVASCULAR]
      ,[CKD]
      ,[COPD]
      ,[CORONARY_ANGIOGRAM]
      ,[DIABETES]
      ,[DIALYSIS]
      ,[EPILEPSY]
      ,[HEART_FAILURE]
      ,[HYPERTENSION]
      ,[IHD]
      ,[MOOD]
      ,[MS]
      ,[OSTEOARTHRITIS]
      ,[OSTEOPOROSIS]
      ,[PARKINSON]
      ,[PSYCHOSES]
      ,[PTCA]
      ,[RHEUMATOID_ARTHRITIS]
      ,[TRANSPLANT]
      ,[STROKE]
      ,[DEPRESSION_EPISODIC]

	  -- flags for exidstence of cost data: (less preferred than using cost data) 
      ,[SL01_MSP]
      ,[SL01_HCN]
      ,[SL02_MSP]
      ,[SL02_DAD]
      ,[SL03_MSP]
      ,[SL03_DAD]
      ,[SL04_MSP]
      ,[SL04_DAD]
      ,[SL04_PCMH]
      ,[SL04_PNMH]
      ,[SL05_MSP]
      ,[SL06_MSP]
      ,[SL06_DAD]
      ,[SL07_MSP]
      ,[SL07_NACRS]
      ,[SL07_ED]
      ,[SL08_DAD]
      ,[SL09_DAD]
      ,[SL10_DAD]
      ,[SL11_MSP]
      ,[SL11_DAD]
     ,[SL12_DAD]
      ,[SL13_MSP]
      ,[SL13_DAD]
      ,[SL13_PCPA]
      ,[SL13_PNPA]
      ,[SL14_MSP]
      ,[SL15_MSP]
      ,[SL16_MSP]
      ,[SL16_DAD]
      ,[SL17_PC]
      ,[SL17_PN]
      ,[SL18_MSP]
      ,[SL19_MSP]
      ,[SL20_MSP]
      ,[SL20_DAD]
      ,[SL20_REHAB_OTHER]
      ,[SL22_AL]
      ,[SL22_HS]
      ,[SL22_CSIL]
      ,[SL22_ADS]
      ,[SL22_CM]
      ,[SL24_MSP]
      ,[SL24_PCRC]
      ,[SL24_PNRC]
      ,[SL24_RC]
      ,[SL25_MSP]
      ,[SL25_DAD]
      ,[SL30_MSP]
      ,[SL99_MSP]
      
	  -- cost data: might make sense to sum across data sources  
	  ,[SL01_MSP_COST]
      ,[SL01_HCN_VISITS_COST]
      ,[SL02_MSP_COST]
      ,[SL02_DAD_COST]
      ,[SL03_MSP_COST]
      ,[SL03_DAD_COST]
      ,[SL04_MSP_COST]
      ,[SL04_DAD_COST]
      ,[SL04_PCMH_COST]
      ,[SL04_PNMH_COST]
      ,[SL05_MSP_COST]
      ,[SL06_MSP_COST]
      ,[SL06_DAD_COST]
      ,[SL07_MSP_COST]
      ,[SL07_NACRS_COST]
      ,[SL07_ED_COST]
      ,[SL08_DAD_COST]
      ,[SL09_DAD_COST]
      ,[SL10_DAD_COST]
      ,[SL11_MSP_COST]
      ,[SL11_DAD_COST]
      ,[SL12_DAD_COST]
      ,[SL13_MSP_COST]
      ,[SL13_DAD_COST]
      ,[SL13_PCPA_COST]
      ,[SL13_PNPA_COST]
      ,[SL14_MSP_COST]
      ,[SL15_MSP_COST]
      ,[SL16_MSP_COST]
      ,[SL16_DAD_COST]
      ,[SL17_PC_COST]
      ,[SL17_PN_COST]
      ,[SL18_MSP_COST]
      ,[SL19_MSP_COST]
      ,[SL20_MSP_COST]
      ,[SL20_DAD_COST]
      ,[SL20_REHAB_OTHER_VISITS_COST]
      ,[SL22_AL_DAYS_COST]
      ,[SL22_HS_HOURS_COST]
      ,[SL22_CSIL_HOURS_COST]
      ,[SL22_ADS_DAYS_COST]
      ,[SL22_CM_VISITS_COST]
      ,[SL24_MSP_COST]
      ,[SL24_PCRC_COST]
      ,[SL24_PNRC_COST]
      ,[SL24_RC_DAYS_COST]
      ,[SL25_MSP_COST]
      ,[SL25_DAD_COST]
      ,[SL30_MSP_COST]
      ,[SL99_MSP_COST]
      
	  -- encounters data: todo: can we add across data sources for a particular SL?  
	  ,[SL01_MSP_ENC]
      ,[SL01_HCN_VISITS]
      ,[SL02_MSP_ENC]
      ,[SL02_DAD_ADJ_TDAYS]
      ,[SL02_DAD_ADJ_ARDAYS]
      ,[SL02_DAD_ADJ_ALCDAYS]
      ,[SL02_DAD_ADJ_ICUDAYS]
      ,[SL02_DAD_ADJ_CASES_IP]
      ,[SL02_DAD_ADJ_RIWS_IP]
      ,[SL03_MSP_ENC]
      ,[SL03_DAD_ADJ_TDAYS]
      ,[SL03_DAD_ADJ_ARDAYS]
      ,[SL03_DAD_ADJ_ALCDAYS]
      ,[SL03_DAD_ADJ_ICUDAYS]
      ,[SL03_DAD_ADJ_CASES_DS]
      ,[SL03_DAD_ADJ_CASES_IP]
      ,[SL03_DAD_ADJ_RIWS_DS]
      ,[SL03_DAD_ADJ_RIWS_IP]
      ,[SL04_MSP_ENC]
      ,[SL04_DAD_ADJ_TDAYS]
      ,[SL04_DAD_ADJ_ARDAYS]
      ,[SL04_DAD_ADJ_ALCDAYS]
      ,[SL04_DAD_ADJ_ICUDAYS]
      ,[SL04_DAD_ADJ_CASES_DS]
      ,[SL04_DAD_ADJ_CASES_IP]
      ,[SL04_DAD_ADJ_RIWS_DS]
      ,[SL04_DAD_ADJ_RIWS_IP]
      ,[SL05_MSP_ENC]
      ,[SL06_MSP_ENC]
      ,[SL06_DAD_ADJ_TDAYS]
      ,[SL06_DAD_ADJ_ARDAYS]
      ,[SL06_DAD_ADJ_ALCDAYS]
      ,[SL06_DAD_ADJ_ICUDAYS]
      ,[SL06_DAD_ADJ_CASES_DS]
      ,[SL06_DAD_ADJ_CASES_IP]
      ,[SL06_DAD_ADJ_RIWS_DS]
      ,[SL06_DAD_ADJ_RIWS_IP]
      ,[SL07_MSP_ENC]
      ,[SL07_NACRS_ENC]
      ,[SL07_ED_ENC]
      ,[SL08_DAD_ADJ_TDAYS]
      ,[SL08_DAD_ADJ_ARDAYS]
      ,[SL08_DAD_ADJ_ALCDAYS]
      ,[SL08_DAD_ADJ_ICUDAYS]
      ,[SL08_DAD_ADJ_CASES_IP]
      ,[SL08_DAD_ADJ_RIWS_IP]
      ,[SL09_DAD_ADJ_CASES_DS]
      ,[SL09_DAD_ADJ_RIWS_DS]
      ,[SL10_DAD_ADJ_TDAYS]
      ,[SL10_DAD_ADJ_ARDAYS]
      ,[SL10_DAD_ADJ_ALCDAYS]
      ,[SL10_DAD_ADJ_ICUDAYS]
      ,[SL10_DAD_ADJ_CASES_IP]
      ,[SL10_DAD_ADJ_RIWS_IP]
      ,[SL11_MSP_ENC]
      ,[SL11_DAD_ADJ_TDAYS]
      ,[SL11_DAD_ADJ_ARDAYS]
      ,[SL11_DAD_ADJ_ALCDAYS]
      ,[SL11_DAD_ADJ_ICUDAYS]
      ,[SL11_DAD_ADJ_CASES_IP]
      ,[SL11_DAD_ADJ_RIWS_IP]
      ,[SL12_DAD_ADJ_TDAYS]
      ,[SL12_DAD_ADJ_ARDAYS]
      ,[SL12_DAD_ADJ_ALCDAYS]
      ,[SL12_DAD_ADJ_ICUDAYS]
      ,[SL12_DAD_ADJ_CASES_IP]
      ,[SL12_DAD_ADJ_RIWS_IP]
      ,[SL13_MSP_ENC]
      ,[SL13_DAD_ADJ_TDAYS]
      ,[SL13_DAD_ADJ_ARDAYS]
      ,[SL13_DAD_ADJ_ALCDAYS]
      ,[SL13_DAD_ADJ_ICUDAYS]
      ,[SL13_DAD_ADJ_CASES_IP]
      ,[SL13_DAD_ADJ_RIWS_IP]
      ,[SL14_MSP_ENC]
      ,[SL15_MSP_ENC]
      ,[SL16_MSP_ENC]
      ,[SL16_DAD_ADJ_TDAYS]
      ,[SL16_DAD_ADJ_ARDAYS]
      ,[SL16_DAD_ADJ_ALCDAYS]
      ,[SL16_DAD_ADJ_ICUDAYS]
      ,[SL16_DAD_ADJ_CASES_DS]
      ,[SL16_DAD_ADJ_CASES_IP]
      ,[SL16_DAD_ADJ_RIWS_DS]
      ,[SL16_DAD_ADJ_RIWS_IP]
      ,[SL18_MSP_ENC]
      ,[SL19_MSP_ENC]
      ,[SL20_MSP_ENC]
      ,[SL20_DAD_ADJ_TDAYS]
      ,[SL20_DAD_ADJ_ARDAYS]
      ,[SL20_DAD_ADJ_ALCDAYS]
      ,[SL20_DAD_ADJ_ICUDAYS]
      ,[SL20_DAD_ADJ_CASES_IP]
      ,[SL20_DAD_ADJ_RIWS_IP]
      ,[SL20_REHAB_OTHER_VISITS]
      ,[SL22_AL_DAYS]
      ,[SL22_HS_HOURS]
      ,[SL22_CSIL_HOURS]
      ,[SL22_ADS_DAYS]
      ,[SL22_CM_VISITS]
      ,[SL24_MSP_ENC]
      ,[SL24_RC_DAYS]
      ,[SL25_MSP_ENC]
      ,[SL25_DAD_ADJ_TDAYS]
      ,[SL25_DAD_ADJ_ARDAYS]
      ,[SL25_DAD_ADJ_ALCDAYS]
      ,[SL25_DAD_ADJ_ICUDAYS]
      ,[SL25_DAD_ADJ_CASES_IP]
      ,[SL25_DAD_ADJ_RIWS_IP]
      ,[SL30_MSP_ENC]
      ,[SL99_MSP_ENC]
  FROM [HealthSystemMatrix].[dbo].[vwVCH_HSM] 
  WHERE FiscalYear in ('13/14')
  ORDER BY FiscalYear
		, POP_SEGMENT; 



/*
-- Mapping HSDAs to COCs: 
-- note: we don't have HSDA data before fyear 13/14 

select distinct hsda 
from [HealthSystemMatrix].[dbo].[vwVCH_HSM]
where HA = ('03 Vancouver Coastal')
	and FiscalYear in ('14/15'); 
*/