

#**********************************************************
# QUICK TEST for WHETHER 2 SAMPLES ARE FROM SAME POISSON PROCESS
#**********************************************************

library("magrittr")

# Reference: https://stats.stackexchange.com/questions/9561/checking-if-two-poisson-samples-have-the-same-mean

# pre-requirement: check that inter-arrival times are roughly exponentially distriubted.
#     (or even better, do a Kolmogorov-Smirnov test)

# sample 1: 7 events in 20 days 
# sample 2: 17 events in 33 days 

n1 <- 7
n2 <- 17

t1 <- 20
t2 <- 33


#***********************************************************************
# 1. APPROACH 1: VISUAL COMPARISONS FROM POISSON DISTRIBUTIONS: -------------
#***********************************************************************

# estimated join mean: 
lambda <- (n1+n2)/(t1+t2)

# histograms ---------------------------------------------
par(mfrow =c(2,1))
replicate(10000, sum(rpois(t1, lambda))) %>% hist
abline(v = n1, col = "blue", lwd = 2)

replicate(10000, sum(rpois(t2, lambda))) %>% hist
abline(v = n2, col = "blue", lwd = 2)


# ECDFs: -------------------------------------------------
par(mfrow =c(2,1))
replicate(10000, sum(rpois(t1, lambda))) %>% ecdf %>% plot 
abline(v = n1, col = "blue", lwd = 2)

replicate(10000, sum(rpois(t2, lambda))) %>% ecdf %>% plot 
abline(v = n2, col = "blue", lwd = 2)


# Conclusion: --------------------------------------------
# Since both n1 and n2 are well within the Poisson distributions 
#     generated by a Poisson process with mean lamda = (n1+n2)/(t1+t2), 
#     we fail to reject the hypothesis that the observed differences 
#     are due to chance alone. 




#***********************************************************************
# 2. APPROACH 2: USING EXACT POISSON TEST 
#***********************************************************************
?poisson.test

poisson.test(c(n1, n2), c(t1, t2), alternative = c("two.sided"))
# p-value is for the null hypothesis that rate 1 = rate 2. 
# p = 0.52 ==> fail to reject null hypothesis 

# 95% CI includes the ratio of 1.0. 


